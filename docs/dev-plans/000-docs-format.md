# DEV-PLAN-000：开发计划文档规范

**状态**: 规划中（2025-12-06 00:10 UTC）

## 格式约定
1. **标题**：使用 `# DEV-PLAN-XXX：标题`，其中 `XXX` 为三位编号（000-999）。  
2. **状态行**：标题下方必须出现 `**状态**: <状态>（<YYYY-MM-DD HH:MM> <TZ>）`，时间戳为 24 小时制，推荐使用 UTC；如需补充备注可在时间戳后以 `— ...` 追加。  
3. **状态枚举**：  
   - `规划中` / `草拟中`：方案尚未启动或部分执行。  
   - `进行中`：已投入执行但未全部完成。  
   - `准备就绪` / `已批准`：前置条件已满足，可进入实施。  
   - `已完成`：所有步骤完成并验证无误。  
4. **背景/目标/步骤/交付**：按需编写 `## 背景`、`## 目标`、`## 实施步骤`、`## 交付物` 等章节，保持层级清晰。

## 待办事项写法
- 统一使用编号步骤或要点，每项前置 `[ ]` 复选框表示未完成。  
- 如果步骤完成，将 `[ ]` 改为 `[X]`，并在正文中记录关键成果或命令（包含时间戳/环境要素）。  
- 若新增子任务，可在原步骤下追加子列表，但依然使用 `[ ]`/`[X]`。

示例：
```
## 实施步骤
1. [X] 初始化数据库 —— 已执行 `make db migrate up`
2. [ ] 构建前端资源 —— 等待合并 #123
```

## 准备就绪与命令记录
- 前置 readiness 或校验类任务（如 `make authz-test authz-lint`、schema drift 检查、基线启动验证）必须以勾选项呈现，并写明执行命令、结果与时间戳。  
- 涉及共用审计表的命令需同步登记到对应 `docs/dev-records/DEV-PLAN-XXX-...md` 表格，保持时间、命令、结果一致。  
- 当所有前置项勾选后，再将状态置为 `准备就绪/已批准`，并在状态行写入同一时间戳。
- **SSOT 引用规则（避免漂移）**：当计划涉及工具链/门禁/生成物（如 sqlc、Atlas/Goose、Authz、Routing、Outbox、多语言等）时，文档中应以“链接/引用”的方式指向单一事实源：`AGENTS.md`（触发器矩阵与本地必跑）、`Makefile`、`.github/workflows/quality-gates.yml`，以及对应的复用手册/计划（例如 `docs/dev-plans/009A-r200-tooling-playbook.md` 和相关 dev-plan/runbook）。除非是**本次实际执行记录**（带时间戳与结果），否则不要在 dev-plan 中复制整段命令清单或矩阵。

## 测试与覆盖率（当仓库启用覆盖率门禁时为必填）
- 若仓库或计划要求“覆盖率门禁”（例如 Greenfield 仓库的 100%），dev-plan 必须包含一个明确的“测试与覆盖率”小节，至少说明：
  - **覆盖率口径**：Line/Branch（或其他口径），以及是否按 package/模块聚合计算。
  - **统计范围**：哪些目录/层纳入统计（例如是否排除生成代码、第三方、调试脚手架）。
  - **目标阈值**：如 100% / 95% 等；若存在排除项，需给出明确的准入规则与审计方式。
  - **证据记录**：以 SSOT 入口（`Makefile`/CI workflow）引用为准，并在 readiness 勾选项里登记“实际执行记录”（时间戳、环境、结果、链接）。
- 若目标为 100% 覆盖率，应将“无法合理测试的分支/路径”视为设计信号：必须在“关键设计决策/边界/非目标”中解释如何通过拆分职责、纯函数化、接口隔离等方式让其可测，而不是在末尾临时豁免。

## 状态更新规则
- 当所有 `[ ]` 条目均更新为 `[X]`，须将文档顶部状态改为 `**状态**: 已完成（YYYY-MM-DD HH:MM）`，时间戳填入完成时刻。  
- 若仅部分完成或新增任务，保持 `规划中` 或 `进行中`，并更新时间戳。  
- 任何状态变更都应伴随对步骤的描述或新增条目，确保读者可追溯。

## 提交流程
- 新建或更新 dev-plan 文档后执行 `go fmt ./...` 等项目惯例检查，确保 PR 与门禁一致。  
- 提交信息推荐包含 `DEV-PLAN-XXX` 方便追踪。  
- 合并前请自检是否遵循上述格式，否则 reviewer 有权驳回。
