# IOTA SDK

![Dashboard](images/showcase.jpg)

## ğŸ”— Links

- [Discord Community](https://discord.gg/zKeTEZAQqF): Join our community for support and Q&A
- [Contribution Guide](docs/CONTRIBUTING.MD): Learn how to contribute to the project
- [Setup Demo](https://github.com/iota-uz/sdk-demo): Learn how to setup IOTA-SDK
- [Demo stand](https://demo.iotaerp.com): Explore the SDK UI
- [Docker hub](https://hub.docker.com/r/iotauz/sdk) - Official Docker images
- [Roadmap (Coming soon...)](docs/): Explore our upcoming features and milestones
- [Figma Designs (Coming soon...)](https://www.figma.com/): Access and contribute to our open-source designs

## ğŸ›  Built With

- [Go](https://go.dev): A statically typed, compiled programming language designed for high performance.
- [htmx](https://htmx.org): Enables modern interactivity with minimal JavaScript.
- [Alpine.js](https://alpinejs.dev): A lightweight JavaScript framework for reactive components.
- [Templ](https://templ.sh): A powerful templating system for building server-rendered web applications.

## âš™ï¸ Prerequisites

- Go 1.24.10+
- Node.js 20+ (for tooling like Playwright/Tailwind)
- PostgreSQL 17 (local `docker compose` files run `postgres:17` to mirror CI)

## âœ… Quality Gates

- `.github/workflows/quality-gates.yml` runs on every push to `main`/`dev` and on all pull requests. It pins Go 1.24.10, installs templ/Tailwind/golangci-lint/pgformatter, and uploads `coverage.out`, `coverage.html`, and `migrate.log` artifacts.
- Costly checks are scoped to file changes: `.templ`/Tailwind assets trigger `make generate` + `make css` + `git status`, locale JSON triggers `make check tr`, and migrations/schema SQL trigger PostgreSQL 17 + Redis smoke migrations (`make db migrate up/down` + `make db seed`).
- Unit/integration tests always run with PostgreSQL 17/Redis containers, ensuring parity between local development and CI.
- Clean architecture 008 å®ˆæŠ¤ï¼š`.gocleanarch.yml` çº¦æŸäº† modules/*/{domain,services,presentation,infrastructure} ä¹‹é—´çš„ä¾èµ–ï¼Œ`make check lint` å’Œ `quality-gates` çš„ lint job éƒ½ä¼šè¿è¡Œ go-cleanarchï¼ˆä»…åœ¨ Go ä»£ç æˆ–è¯¥é…ç½®æ–‡ä»¶å˜æ›´æ—¶è§¦å‘ï¼‰ã€‚

**Before pushing**, run the commands that match your changes so you know `quality-gates` will pass:

- Go code: `go fmt ./... && go vet ./... && make check lint`
- Clean architecture: `.gocleanarch.yml` æè¿°äº† domain/services/presentation/infrastructure çš„ä¾èµ–å›¾è°±ï¼Œ`make check lint` ä¼šè‡ªåŠ¨è¿è¡Œ go-cleanarchï¼ˆæœ¬åœ°ä¸ CI å‡å¤ç”¨ï¼‰ã€‚
- Tests: `make test` (or `go test -v ./...`)
- Templates/Tailwind assets: `make generate && make css` followed by `git status --short`
- Locales: `make check tr`
- Schema/migrations: `make db migrate up && make db seed`
- Finance æ¨¡å—çš„é›†æˆæµ‹è¯•æš‚æ—¶åœç”¨ï¼Œå¦‚éœ€ä¿®æ”¹ `modules/finance/**` è¯·åœ¨æœ¬åœ°è¿è¡Œç›¸å…³ `go test` å¹¶é™„ä¸Šç»“æœã€‚

## ğŸ” Authz Policy Draft API

- ä¿®æ”¹ `config/access/policies/**` åè¿è¡Œ `make authz-pack`ï¼Œå®ƒä¼šåŒæ—¶é‡å»ºèšåˆç­–ç•¥ `config/access/policy.csv` ä»¥åŠ `config/access/policy.csv.rev`ï¼ˆä¾› `pkg/authz/version` è¯»å– base revisionï¼‰ã€‚
- Core æ¨¡å—æ³¨å†Œäº† `PolicyDraftService` ä¸ `/core/api/authz/**` æ§åˆ¶å™¨ï¼Œå¯ç”¨æ¥åˆ›å»º/å®¡æ‰¹/è°ƒè¯•ç­–ç•¥è‰ç¨¿ï¼›æ‰€æœ‰ç«¯ç‚¹éƒ½éœ€è¦å¯¹åº”çš„ `Authz.*` æƒé™ã€‚
- å¸¸ç”¨ç«¯ç‚¹ï¼š
  - `GET /core/api/authz/policies` â€”â€” è¿”å›å½“å‰èšåˆç­–ç•¥åˆ—è¡¨ï¼ˆä»… `Authz.Debug` å¯è§ï¼‰ã€‚
  - `POST /core/api/authz/requests` â€”â€” åˆ›å»ºç­–ç•¥è‰ç¨¿ï¼›`POST /requests/{id}/approve|reject|cancel|trigger-bot|revert` è´Ÿè´£ç”Ÿå‘½å‘¨æœŸæ“ä½œã€‚
- `GET /core/api/authz/debug?subject=...&object=...&action=...` â€”â€” è°ƒè¯•æ¥å£ï¼Œä»… `Authz.Debug` å¯è§ï¼Œæ”¯æŒ `attr.<key>=<value>` æ³¨å…¥ ABAC å±æ€§ï¼Œå¹¶å¸¦æœ‰ `20 req/min/IP` é€Ÿç‡é™åˆ¶ï¼›å“åº”åŒ…å« `allowed`ã€`mode`ã€`latency_ms`ã€`trace.matched_policy` ä»¥åŠå›æ˜¾çš„ request/attributesã€‚

ç¤ºä¾‹ï¼š

```bash
REVISION=$(jq -r .revision config/access/policy.csv.rev)
curl -X POST http://localhost:3200/core/api/authz/requests \
  -H "Content-Type: application/json" \
  -b sid=<session_cookie> \
  -d '{
    "object": "core.users",
    "action": "read",
    "reason": "Grant reporting access",
    "base_revision": "'"$REVISION"'",
    "diff": [{"op":"add","path":"/p/-","value":["role:reporting","core.users","read","global","allow"]}]
  }'
```

Authz.Debug ç¤ºä¾‹ï¼ˆæºå¸¦ request id æ–¹ä¾¿å®¡è®¡ï¼‰ï¼š

```bash
curl "http://localhost:3200/core/api/authz/debug?subject=role:core.superadmin&domain=global&object=core.users&action=list&attr.ip=10.0.0.1" \
  -H "X-Request-Id: authz-debug-sample" \
  -b sid=<session_cookie>
# => {
#   "allowed": true,
#   "mode": "enforce",
#   "latency_ms": 3,
#   "request": {...},
#   "attributes": {"ip":"10.0.0.1"},
#   "trace": {"matched_policy":["role:core.superadmin","*","*","*","allow"]}
# }
```

### Authz Bot & PR æµç¨‹

- Bot å¯é€šè¿‡ `scripts/authz/bot.sh run [--once]` å¯åŠ¨ï¼›éœ€è¦ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
  - `AUTHZ_BOT_GITHUB_TOKEN`ï¼šå…·å¤‡ `repo` æƒé™çš„ PATï¼Œç”¨äºåˆ›å»º/æ›´æ–° PRã€‚
  - å¯é€‰ `AUTHZ_BOT_GIT_TOKEN`ï¼šè‹¥æœ¬åœ° remote ä»ä¸º SSHï¼Œå¯ä¸´æ—¶æ³¨å…¥ HTTPS ä»¤ç‰Œã€‚
  - `AUTHZ_BOT_GIT_REMOTE`/`AUTHZ_BOT_GIT_BRANCH_PREFIX`/`AUTHZ_BOT_GIT_AUTHOR`ï¼ˆå¦‚éœ€è¦†ç›–é»˜è®¤å€¼ï¼‰ã€‚
- æµç¨‹ï¼šå®¡æ‰¹é€šè¿‡çš„è‰ç¨¿ â†’ è¿è¡Œ bot â†’ bot åº”ç”¨ diffã€æ‰§è¡Œ `make authz-pack && make authz-test`ã€æ¨é€åˆ†æ”¯å¹¶è°ƒç”¨ GitHub API å¼€ PR â†’ `PolicyDraftService` å›å†™ `applied_policy_revision/snapshot/pr_link`ï¼Œè¯·æ±‚çŠ¶æ€å˜ä¸º `merged`ã€‚
- å¦‚éœ€å¼ºåˆ¶é‡Šæ”¾é”ï¼Œå¯æ‰§è¡Œ `scripts/authz/bot.sh force-release <request-id>`ï¼Œå®ƒä¼šæ¸…ç©º `policy_change_requests.bot_lock/bot_locked_at`ï¼Œä¾¿äºé‡è¯•ã€‚
- å›æ»šï¼šè°ƒç”¨ `/core/api/authz/requests/{id}/revert` ç”Ÿæˆæ–°è‰ç¨¿ï¼Œæˆ–æ‰‹åŠ¨ revert bot åˆ›å»ºçš„ PRï¼Œå†ç”± bot é‡è·‘ä¸€æ¬¡ã€‚
- æ›´å¤šæ‰‹åŠ¨/åº”æ€¥æ­¥éª¤ã€ç¼“å­˜ç­–ç•¥ä¸å›æ»šè¯´æ˜è¯·å‚è§ `docs/runbooks/AUTHZ-BOT.md`ã€‚

### PostgreSQL 17 è¿ç§»ä¸å¤‡ä»½

1. **å¤‡ä»½æ—§æ•°æ®**ï¼ˆå¦‚æœä¹‹å‰è¿è¡Œçš„æ˜¯ `postgres:15`ï¼‰ï¼š  
   ```bash
   docker compose -f compose.dev.yml down db
   docker run --rm --network host -v sdk-data:/var/lib/postgresql/data postgres:15 \
     pg_dump -h localhost -p 5438 -U postgres -F c -b -v -f /tmp/pg15-backup.dump iota_erp
   ```
   å°† `/tmp/pg15-backup.dump` å¤åˆ¶åˆ°å®‰å…¨ä½ç½®ã€‚

2. **æ¸…ç†æ—§å·å¹¶åˆ‡æ¢åˆ° 17**ï¼š  
   ```bash
   docker volume rm sdk-data
   docker compose -f compose.dev.yml up -d db redis
   ```

3. **é‡æ–°è¿ç§»ä¸ç§å­**ï¼š  
   ```bash
   DB_HOST=localhost DB_PORT=5438 DB_NAME=iota_erp DB_USER=postgres DB_PASSWORD=postgres make db migrate up
   DB_HOST=localhost DB_PORT=5438 DB_NAME=iota_erp DB_USER=postgres DB_PASSWORD=postgres make db seed
   ```

è‹¥éœ€è¦ä»å¤‡ä»½æ¢å¤ï¼Œå¯ä½¿ç”¨ `pg_restore` å°† `pg15-backup.dump` å¯¼å…¥æ–°çš„ `postgres:17` å®ä¾‹ã€‚

---  

## A Modular and Configurable ERP Solution

**IOTA SDK** is an open-source, modular, and feature-complete **ERP system** designed to adapt to multiple economic
sectors, including **finance**, **manufacturing**, and **warehouse management**. Inspired by leading platforms like
Odoo, IOTA SDK provides an intuitive framework to accelerate enterprise operations and unlock efficiency with powerful
tools and integrations.

---  

## ğŸš€ Key Features

- **Configurable Architecture**: Fully modular components to customize workflows.
- **Industry-Specific Modules**: Finance, manufacturing, warehouse management, and more.
- **GraphQL API**: Simplifies querying and data management.
- **Open Source**: Fully extensible and transparent.

---  

## ğŸ“… Roadmap

We have an ambitious roadmap to enhance IOTA SDK's capabilities and provide a robust framework for ERP needs across
various industries. Here's what's in the pipeline:

### Core Modules

- **Finance & Accounting**: Develop comprehensive tools for managing financial operations, including general ledger,
  accounts payable/receivable, and payroll.

### Work In Progress

- **CRM**: Building a customer relationship management module to streamline client interactions and sales processes.
- **BIâ€‘Chat**: Introducing a business intelligence chatbot for real-time data insights and reporting.

### Upcoming Features

- **HRM**: Integrate a human resources management module for employee onboarding, payroll, and benefits.
- **Password Vault**: Securely store and manage sensitive credentials within the platform.
- **DSL**: Integrate V8/Python for scripting and customizations.
- **Logging**: Implement a logging system for tracking user actions and system events.
- **Invoice and Document Generation**: Leverage [GOBL](https://github.com/invopop/gobl) for generating and managing
  invoices and other essential business documents.
- **Documentation Website**: Launch a comprehensive docs website to streamline onboarding and provide detailed guidance
  for developers and users.
- **Open Source Designs and Documentation**: Share Figma designs and other internal documentation to help the community
  understand the vision and contribute more effectively.

---  

## ğŸ› ï¸ Developer Tools

### DevHub CLI

DevHub is a powerful Terminal User Interface (TUI) for managing development services. It provides centralized control over all your project's services from a single interface.

**Installation:**
```bash
go install github.com/iota-uz/devhub/cmd/devhub@latest
```

Learn more in the [DevHub documentation](https://github.com/iota-uz/devhub).

---

## ğŸ§© HRM sqlc å·¥ä½œæµ

`modules/hrm` çš„ SQL ç°å·²ç»Ÿä¸€ä½¿ç”¨ sqlc ç”Ÿæˆã€‚ä¿®æ”¹ HRM è¡¨ç»“æ„æˆ– SQL æ—¶è¯·éµå¾ªä»¥ä¸‹é¡ºåºï¼š

1. ç»´æŠ¤è¿ç§»æˆ– schemaï¼Œå¹¶åŒæ­¥æ›´æ–° `docs/dev-records/hrm-sql-inventory.md`ï¼ˆæ–°å¢/è°ƒæ•´æŸ¥è¯¢éƒ½è¦ç™»è®°ï¼‰ã€‚
2. è¿è¡Œ `scripts/db/export_hrm_schema.sh` å¯¼å‡ºæœ€æ–° schemaï¼ˆå¯é€šè¿‡ `SKIP_MIGRATE=1` è·³è¿‡è‡ªåŠ¨è¿ç§»ï¼‰ã€‚
3. æ‰§è¡Œ `make sqlc-generate`ï¼ˆæˆ– `make generate`ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨è¯¥ç›®æ ‡ï¼‰ä»¥é‡å»º `modules/hrm/infrastructure/sqlc/**`ã€‚
4. `git status --short` ç¡®è®¤æ²¡æœ‰é—æ¼çš„ç”Ÿæˆæ–‡ä»¶ï¼Œå†æäº¤ PRã€‚

CI ä¸­æ–°å¢çš„ `hrm-sqlc` è¿‡æ»¤å™¨ä¼šåœ¨æ¶‰åŠ HRM SQL / schema / sqlc.yaml å˜æ›´æ—¶å¼ºåˆ¶æ‰§è¡Œä¸Šè¿°æµç¨‹ï¼Œå¹¶æ‹’ç»åŒ…å«æœªæäº¤ç”Ÿæˆç»“æœçš„ PRã€‚

---

## ğŸ§­ HRM Atlas + Goose æµæ°´çº¿

HRM èšåˆå·²ç»è¿å…¥ `migrations/hrm/`ï¼Œå¹¶ç”± Atlas ç”Ÿæˆ SQLã€goose è´Ÿè´£æ‰§è¡Œã€‚åŸºçº¿äº§ç‰©ï¼š

- ç›®æ ‡ schemaï¼š`modules/hrm/infrastructure/atlas/schema.hcl`
- Atlas é…ç½®ï¼šæ ¹ç›®å½• `atlas.hcl`ï¼ˆ`dev`/`test`/`ci` ç¯å¢ƒå¤ç”¨ `DB_*` ç¯å¢ƒå˜é‡ï¼‰
- è¿ç§»ç›®å½•ï¼š`migrations/hrm/changes_<unix>.{up,down}.sql`
- å·¥ä½œæ—¥å¿—ï¼š`docs/dev-records/DEV-PLAN-011-HRM-ATLAS-POC.md`

æ¨èæµç¨‹ï¼š

1. **å®‰è£… Atlas CLIï¼ˆä¸€æ¬¡æ€§ï¼‰**
   ```bash
   make atlas-install   # ä» GitHub æ„å»º atlas v0.38.0 å¹¶å®‰è£…åˆ° $(go env GOPATH)/bin
   ```
2. **æ›´æ–° schema å®šä¹‰**ï¼šç¼–è¾‘ `modules/hrm/infrastructure/atlas/schema.hcl`ï¼ˆæˆ–è¡¥å…… includeï¼‰ï¼Œç¡®ä¿ä¸ HRM æœŸæœ›ç»“æ„ä¸€è‡´ã€‚
3. **Dry-run è®¡åˆ’**ï¼š
   ```bash
   make db plan
   # ç­‰ä»·äº atlas migrate diff --env dev --dir file://migrations/hrm --to file://modules/hrm/infrastructure/atlas/schema.hcl --dry-run
   ```
   è¯¥å‘½ä»¤ä¼šè¿æ¥æœ¬åœ° Postgresï¼ˆä½¿ç”¨ç°æœ‰ `DB_*` ç¯å¢ƒå˜é‡ï¼‰å¹¶æ‰“å° SQL è®¡åˆ’ï¼Œä¸å†™å…¥ç£ç›˜ã€‚
4. **ç”Ÿæˆè¿ç§»**ï¼š
   ```bash
   atlas migrate diff --env dev \
     --dir file://migrations/hrm \
     --to file://modules/hrm/infrastructure/atlas/schema.hcl
   ```
   è¾“å‡ºæ–‡ä»¶ä½äº `migrations/hrm/changes_<unix>.{up,down}.sql`ï¼Œå¹¶è‡ªåŠ¨æ›´æ–° `migrations/hrm/atlas.sum`ã€‚
5. **åº”ç”¨è¿ç§»ï¼ˆgooseï¼‰**ï¼š
   ```bash
   make db migrate up HRM_MIGRATIONS=1
   ```
   å½“ `HRM_MIGRATIONS=1` æ—¶ï¼Œ`Makefile` ä¼šè°ƒç”¨ `scripts/db/run_goose.sh`ï¼Œä½¿ç”¨ `postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}` ä½œä¸º DSNã€‚  
   - å›æ»šæœ€è¿‘ä¸€æ¬¡ï¼š`GOOSE_STEPS=1 make db migrate down HRM_MIGRATIONS=1`  
   - redoï¼š`GOOSE_STEPS=1 make db migrate redo HRM_MIGRATIONS=1`  
   - çŠ¶æ€ï¼š`make db migrate status HRM_MIGRATIONS=1`
6. **å¯¼å‡º schema & é‡å»º sqlc**ï¼š
   ```bash
   scripts/db/export_hrm_schema.sh SKIP_MIGRATE=1
   make sqlc-generate
   ```
7. **æäº¤å‰æ£€æŸ¥**ï¼š`make db lint` ä¼šè¿è¡Œ `atlas migrate lint --env ci --git-base origin/main`ï¼Œç¡®ä¿ç¼ºå¤±è¿ç§» / hash æ¼‚ç§»ä¼šè¢«é˜»æ­¢ã€‚

> æ‰€æœ‰ Atlas/Goose æ“ä½œè¯·åœ¨ `docs/dev-records/DEV-PLAN-011-HRM-ATLAS-POC.md` è¡¥å……è®°å½•ï¼Œæ–¹ä¾¿åç»­å®¡è®¡å’Œå›æº¯ã€‚

---

## ğŸ” Super Admin

IOTA SDK includes a separate Super Admin server for managing tenants and platform-wide operations. This deployment is isolated from the main application and requires super admin authentication for all routes.

**Key Features:**
- Separate deployment context (uses same environment variables)
- Only core + superadmin modules loaded (lightweight)
- Global authentication middleware enforcing super admin access
- Tenant management and platform analytics

**Quick Start:**
```bash
# Build Super Admin server
docker build -f Dockerfile.superadmin -t iota-sdk-superadmin .

# Run Super Admin server (uses same env vars as main app)
docker run -p 3000:3000 \
  -e DATABASE_URL=postgres://... \
  -e PORT=3000 \
  iota-sdk-superadmin
```

For detailed documentation, deployment guides, and authentication flow, see [Super Admin Documentation](docs/SUPERADMIN.md).

---

## ğŸ“„ Licence

Apache 2.0 

Updated at Jan 6, 2025

## ğŸŒŸ Join Us

<img width="250" style="display: block" src="https://cdn.prod.website-files.com/660549b5ac888804e6582845/6606afddd43da2d659209149_logo.svg">  

We welcome contributions to improve and expand IOTA SDK! Check out our [contributing guide](docs/CONTRIBUTING.MD) to get
started.
